# 智能机器臂喂食控制系统 - 用户手册

## 📋 目录
1. [系统概述](#系统概述)
2. [安装说明](#安装说明)
3. [硬件准备](#硬件准备)
4. [软件使用](#软件使用)
5. [故障排除](#故障排除)
6. [技术支持](#技术支持)

## 🎯 系统概述

智能机器臂喂食控制系统是一个基于计算机视觉和串口通信的自动化喂食解决方案。系统能够：

- **智能检测**: 使用MediaPipe检测人脸嘴部位置
- **精确控制**: 根据嘴部位置实时调整机器臂舵机角度
- **多种模式**: 支持单次喂食和动态跟踪两种工作模式
- **安全可靠**: 内置多重安全保护机制

## 🔧 安装说明

### 系统要求
- Windows 10/11 64位系统
- Python 3.8 或更高版本
- 至少 4GB 内存
- USB摄像头
- 串口设备（USB转串口或板载串口）

### 软件安装

#### 方法一：自动安装（推荐）
1. 双击运行 `启动应用.bat`
2. 系统会自动检查并安装必要的依赖包

#### 方法二：手动安装
```bash
# 安装Python依赖包
pip install opencv-python mediapipe pyserial numpy tkinter

# 如果使用conda环境
conda install opencv mediapipe pyserial numpy
pip install mediapipe  # mediapipe通常需要通过pip安装
```

## 🔌 硬件准备

### 1. 摄像头设置
- 连接USB摄像头到电脑
- 确保摄像头被识别为设备1（默认设置）
- 调整摄像头位置，确保能清楚拍摄到面部

### 2. 串口连接
- 将机器臂控制板连接到电脑USB端口
- 记录分配的COM端口号（如COM5）
- 确认波特率设置（默认115200）

### 3. 舵机配置
- **舵机1**: 水平面旋转控制
- **舵机2**: 竖直面旋转控制  
- **舵机3**: 辅助位置控制
- **舵机4**: 喂食动作控制

## 💻 软件使用

### 启动应用程序

1. **图形界面启动**
   - 双击 `启动应用.bat`
   - 或运行 `python app_launcher.py`

2. **命令行启动**
   - 运行 `python calculate_angle.py`

### 主界面功能

#### 连接设置区域
- **串口选择**: 选择正确的COM端口
- **波特率设置**: 通常使用115200
- **连接状态**: 显示当前连接状态

#### 控制面板
- **启动终端控制**: 启动命令行控制界面
- **启动图形界面**: 启动完整图形控制界面

#### 快速测试
- **测试摄像头**: 验证摄像头是否正常工作
- **测试串口**: 验证串口连接是否正常
- **测试嘴部检测**: 启动嘴部检测演示

### 控制模式

#### 图形界面控制（推荐）

新版应用程序提供了直观的图形界面，包含以下主要控制按钮：

**主要控制按钮**：
1. **开始喂食** - 执行单次嘴部检测和喂食动作
2. **动态跟踪模式** - 启动实时嘴部跟踪喂食
3. **停止喂食** - 停止所有动作并复位舵机
4. **初始化舵机** - 重新初始化所有舵机到默认位置
5. **退出程序** - 安全退出应用程序

**设备测试按钮**：
- **测试摄像头** - 验证摄像头连接和画质
- **测试串口** - 检测串口通信状态  
- **测试嘴部检测** - 启动嘴部检测演示

**手动控制**：
- 每个舵机都可以独立设置角度（0-180度）
- 实时发送控制命令到机器臂

#### 终端控制模式

如果需要使用命令行控制，可以直接运行 `calculate_angle.py`：

- `start` - 开始单次喂食
  - 截取一帧图像检测嘴部
  - 根据位置自动调整舵机角度
  - 执行喂食动作

- `dynamic` - 动态跟踪模式
  - 实时检测嘴部位置
  - 连续调整舵机角度
  - 按'q'键退出

- `stop` - 停止喂食
  - 停止所有动作
  - 复位舵机到初始位置

- `init` - 重新初始化舵机

- `exit` - 退出程序

#### 2. 图形界面功能特点

**直观操作**：
- 一键连接设备
- 按钮式控制，无需记忆命令
- 实时状态显示和日志输出
- 错误提示和操作指导

**安全保护**：
- 连接状态检测
- 参数范围验证
- 异常处理和恢复
- 优雅的程序退出

**实时反馈**：
- 详细的操作日志
- 设备状态显示
- 舵机响应信息
- 错误诊断提示

### 工作流程

1. **设备准备**
   - 连接摄像头和串口设备
   - 启动应用程序
   - 配置连接参数

2. **系统初始化**
   - 连接串口设备
   - 初始化舵机位置
   - 启动摄像头

3. **开始喂食**
   - 选择 `start` 进行单次喂食
   - 或选择 `dynamic` 进行跟踪喂食
   - 系统自动检测并调整位置

4. **结束操作**
   - 使用 `stop` 命令停止
   - 系统自动复位舵机

## 🔧 故障排除

### 常见问题

#### 1. 串口连接失败
**症状**: 显示"串口连接失败"
**解决方案**:
- 检查USB线缆连接
- 确认COM端口号正确
- 检查设备管理器中的端口状态
- 尝试其他COM端口

#### 2. 摄像头无法打开
**症状**: 显示"摄像头未打开"
**解决方案**:
- 检查摄像头USB连接
- 确认摄像头驱动已安装
- 尝试更改摄像头设备ID
- 关闭其他使用摄像头的程序

#### 3. 嘴部检测失败
**症状**: 显示"未检测到嘴部"
**解决方案**:
- 改善光线条件
- 调整摄像头角度
- 确保面部完整出现在画面中
- 避免遮挡嘴部

#### 4. 舵机无响应
**症状**: 舵机不动作
**解决方案**:
- 检查舵机供电
- 确认串口通信正常
- 检查控制板连接
- 验证命令格式

### 错误代码

- **E001**: 串口初始化失败
- **E002**: 摄像头初始化失败  
- **E003**: 嘴部检测模块加载失败
- **E004**: 舵机通信超时
- **E005**: 角度超出范围

## 📞 技术支持

### 日志文件
程序运行时会生成详细日志，有助于问题诊断：
- 实时日志显示在界面中
- 可保存日志文件进行分析

### 配置文件
系统配置保存在 `config.ini` 文件中，可根据需要修改：
- 串口参数
- 摄像头设置
- 舵机范围
- 应用设置

### 联系方式
如需技术支持，请提供：
1. 详细的错误描述
2. 系统配置信息
3. 日志文件内容
4. 硬件连接示意图

---

## 📈 版本信息

**当前版本**: v1.0
**发布日期**: 2025年7月12日
**兼容性**: Windows 10/11, Python 3.8+

### 更新日志
- v1.0: 初始版本发布
  - 基础喂食控制功能
  - 嘴部检测和跟踪
  - 图形用户界面
  - 配置文件支持

---

*感谢使用智能机器臂喂食控制系统！*
